schema: '2.0'
stages:
  extract_images_from_video:
    cmd: python scripts/image_preprocessing.py extract-images-from-video --path_to_video
      data/raw/video/video.MP4 --path_to_images_folder data/raw/images --amount_of_frames
      150 --metadata data/raw/video/meta.json --colmap_text_folder data/processed/colmap_db/colmap_text
    deps:
    - path: data/processed/colmap_db/colmap_text/cameras.txt
      md5: 215cb1ea462acaae50b8201a690a1c1c
      size: 299
    - path: data/raw/video/video.MP4
      md5: 36448c49d0b5d6aa6a342c4e3edef5a5
      size: 257059112
    - path: scripts/image_preprocessing.py
      md5: d78f6fde0f49f1e589b147c528d339b4
      size: 7457
    outs:
    - path: data/processed/colmap_db/colmap_text/images.txt
      md5: 593ae8269b6f76fdb3721128e2a1d868
      size: 22690
    - path: data/raw/images
      md5: 87a61069b36d202d63b1f4d599743cc4.dir
      size: 230960112
      nfiles: 154
  crop_and_resize_images:
    cmd: python scripts/image_preprocessing.py crop-resize-images --path_to_images_folder
      data/raw/images --path_to_cropped_images_folder data/interim/
    deps:
    - path: data/raw/images
      md5: 87a61069b36d202d63b1f4d599743cc4.dir
      size: 230960112
      nfiles: 154
    - path: scripts/image_preprocessing.py
      md5: d78f6fde0f49f1e589b147c528d339b4
      size: 7457
    outs:
    - path: data/interim
      md5: bf1fee8fa33e246a951c02de4e22ecf3.dir
      size: 159214161
      nfiles: 154
  remove_background:
    cmd: python scripts/image_preprocessing.py remove-background --path_to_cropped_images_folder
      data/interim/ --images_no_background data/processed/images --model_type new
    deps:
    - path: checkpoints/u2net.pth
      md5: 347c3d51b01528e5c6c071e3cff1cb55
      size: 176290937
    - path: data/interim/
      md5: bf1fee8fa33e246a951c02de4e22ecf3.dir
      size: 159214161
      nfiles: 154
    - path: scripts/image_preprocessing.py
      md5: d78f6fde0f49f1e589b147c528d339b4
      size: 7457
    outs:
    - path: data/processed/images/
      md5: af68ed9afcef8a9c9a7707b95c80aca2.dir
      size: 66979424
      nfiles: 154
  colmap2nerf:
    cmd: python scripts/colmap2nerf.py --image_folder data/processed/images --colmap_text_folder
      data/processed/colmap_db/colmap_text --output data/processed/configs/nerf_transforms.json
    deps:
    - path: data/processed/colmap_db/
      md5: 06c231e0343c7041bd39ca416d6fda19.dir
      size: 45978
      nfiles: 4
    - path: data/processed/images/
      md5: af68ed9afcef8a9c9a7707b95c80aca2.dir
      size: 66979424
      nfiles: 154
    - path: scripts/colmap2nerf.py
      md5: 3fc9456986ca58b59ad01e1b04d4ec2a
      size: 8154
    outs:
    - path: data/processed/configs/nerf_transforms.json
      md5: d94f12493f8a9978a193153f46f14300
      size: 91638
  colmap:
    cmd: python scripts/run_colmap.py --images data/interim --colmap_db data/processed/colmap_db/colmap.db
      --text data/processed/colmap_db/colmap_text  --colmap_matcher exhaustive
    deps:
    - path: data/processed/images
      md5: 369bcd90204fe366565e92292954b8db.dir
      size: 66979435
      nfiles: 154
    - path: scripts/run_colmap.py
      md5: b755e80d25da4233c2494147d79a27d0
      size: 3311
    outs:
    - path: data/processed/colmap_db/
      md5: 2d6e07618fad284ee4a0b1488ae167ca.dir
      size: 148837209
      nfiles: 8
