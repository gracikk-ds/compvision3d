schema: '2.0'
stages:
  extract_calibration_images:
    cmd: python scripts/camera_calibration.py extract-calibration-images --video_dir
      data/raw/calibration/video/calibration.MOV --path_to_images_folder data/raw/calibration/images
      --amount_of_frames 30
    deps:
    - path: data/raw/calibration/video
      md5: d0982925721723fc238cb9294917d812.dir
      size: 63767820
      nfiles: 1
    - path: scripts/camera_calibration.py
      md5: d8bb20c28fb9c151fc08f9b230d4d4a5
      size: 5866
    outs:
    - path: data/raw/calibration/images
      md5: 50239b461b3e9ced5c1eb3dd262f94bc.dir
      size: 43004440
      nfiles: 32
  camera_calibration:
    cmd: python scripts/camera_calibration.py calibrate --image_dir data/raw/calibration/images
      --image_format jpg --output_path data/processed/colmap_db/colmap_text/ --square_size
      2.5
    deps:
    - path: data/raw/calibration/images
      md5: 4adf6415b8b1cb87fc8116f8cf0e81e8.dir
      size: 47047943
      nfiles: 30
    - path: scripts/camera_calibration.py
      md5: 199cf7b0bacc3f3121fec96730cfb0f0
      size: 5865
    outs:
    - path: data/processed/colmap_db/colmap_text/cameras.txt
      md5: 6ae83d14b3b986082983f16578ea6213
      size: 294
  extract_images_from_video:
    cmd: python scripts/image_preprocessing.py extract-images-from-video --path_to_video
      data/raw/video/video.mp4 --path_to_images_folder data/raw/images --amount_of_frames
      50 --metadata data/raw/meta/meta.json --colmap_text_folder data/processed/colmap_db/colmap_text
    deps:
    - path: data/processed/colmap_db/colmap_text/cameras.txt
      md5: 6ae83d14b3b986082983f16578ea6213
      size: 294
    - path: data/raw/video
      md5: 8cbd792a29be488d50214ef3cf0ce870.dir
      size: 174514224
      nfiles: 1
    - path: scripts/image_preprocessing.py
      md5: 4b9cee02104edba277b4b05863abf35a
      size: 8408
    outs:
    - path: data/processed/colmap_db/colmap_text/images.txt
      md5: 405f7425b779a434e69ccb613735645f
      size: 8046
    - path: data/raw/images
      md5: 090f9d40edc0f773c7ff47366a511601.dir
      size: 16956839
      nfiles: 51
  crop_and_resize_images:
    cmd: python scripts/image_preprocessing.py crop-resize-images --path_to_images_folder
      data/raw/images --path_to_cropped_images_folder data/interim/
    deps:
    - path: data/raw/images
      md5: 090f9d40edc0f773c7ff47366a511601.dir
      size: 16956839
      nfiles: 51
    - path: scripts/image_preprocessing.py
      md5: 4b9cee02104edba277b4b05863abf35a
      size: 8408
    outs:
    - path: data/interim
      md5: 2c6fa5495eb581b655cf7ab433a0a073.dir
      size: 48700327
      nfiles: 51
  remove_background:
    cmd: python scripts/image_preprocessing.py remove-background --path_to_cropped_images_folder
      data/interim/ --images_no_background data/processed/images --model_type new
    deps:
    - path: data/interim/
      md5: 2c6fa5495eb581b655cf7ab433a0a073.dir
      size: 48700327
      nfiles: 51
    - path: scripts/image_preprocessing.py
      md5: 4b9cee02104edba277b4b05863abf35a
      size: 8408
    outs:
    - path: data/processed/images/
      md5: 0178b7bea3081e65bf0b3f9e3f62e05b.dir
      size: 41402955
      nfiles: 51
  colmap2nerf:
    cmd: python scripts/colmap2nerf.py --image_folder data/processed/images --colmap_text_folder
      data/processed/colmap_db/colmap_text --output data/processed/configs/nerf_transforms.json
    deps:
    - path: data/processed/colmap_db/
      md5: 0d6fa6d098840ab48de15b64b40e47e9.dir
      size: 30601
      nfiles: 5
    - path: data/processed/images/
      md5: 0178b7bea3081e65bf0b3f9e3f62e05b.dir
      size: 41402955
      nfiles: 51
    - path: scripts/colmap2nerf.py
      md5: 8db441f65cf9b0caaf20acb7c55be078
      size: 8182
    outs:
    - path: data/processed/configs/nerf_transforms.json
      md5: 0eec12b0ad54fe2a25b76db29c8faf83
      size: 32475
  reconstruction:
    cmd: python scripts/reconstruction.py --ref_mesh data/processed/configs --out_dir
      data/results
    deps:
    - path: data/processed/configs/nerf_transforms.json
      md5: 9a1bccaa6ce06ca7c12c7aac61638cba
      size: 32252
    - path: data/processed/irrmaps
      md5: 2c8ce340164d93d361b7e95851e1222e.dir
      size: 6333948
      nfiles: 3
    - path: data/processed/tets
      md5: 465437233defb2afa9d9f46d0a03d78e.dir
      size: 62364712
      nfiles: 1
    - path: scripts/reconstruction.py
      md5: 3cd933342a8352beea1acfb366465ed7
      size: 8692
    params:
      params.yaml:
        batch: 2
        iter: 500
        layers: 1
        learning_rate:
        - 0.03
        - 0.01
        save_interval: 250
        spp: 1
        texture_res:
        - 1024
        - 1024
        train_res:
        - 800
        - 800
    outs:
    - path: data/results/eval_mesh
      md5: a04988bf3507eeca3f7364b87faed9f9.dir
      size: 2099320297
      nfiles: 2
    - path: data/results/metrics.json
      md5: 31f0084f07920723c8b7747461576662
      size: 65
